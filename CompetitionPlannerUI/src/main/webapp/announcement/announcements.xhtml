<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" 
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui">

	<ui:composition template="/templates/search.xhtml">
		<ui:param name="bundle" value="#{messages.bundle('announcements')}"/>
		<ui:param name="typ" value="org.planner.eo.Announcement"/>
		<ui:param name="bearbeitenLink" value="/announcement/announcementEdit.xhtml"/>
		<ui:param name="editBean" value="#{announcementBean}"/>
		<ui:param name="renderDownloadSupport" value="true"/>
		<ui:param name="uploadBean" value="#{announcementBean.uploadBean}"/>
		<ui:param name="doubleClickDisabled" value="#{not (authBean.inRole('Sportwart'))}"/>

		<ui:define name="newButton">
			<p:commandButton value="#{bundle.newButton}"
				action="#{searchBean.anlegen(bearbeitenLink, typ, editBean)}"
				process="@form"
				update="mainContent"
				style="margin-right: 5px"
				rendered="#{authBean.inRole('Sportwart')}"/>
		</ui:define>
		<ui:define name="editButton">
			<p:commandButton icon="fa #{item.status != 'announced' ? 'fa-edit' : 'fa-square-o'}"
					title="#{item.status != 'announced' ? bundle.modify : bundle.display}"
					action="#{searchBean.bearbeiten(bearbeitenLink, typ, item, editBean)}"
					process="@form"
					update="mainContent"
					styleClass="editButton"
					rendered="#{authBean.inRole('Sportwart')}"
					disabled="#{item['club.name'] != authBean.loggedInUser.club.name}"/>
		</ui:define>
		<ui:define name="copyButton">
			<p:commandButton icon="fa fa-copy" title="#{bundle.copy}"
					action="#{searchBean.kopieren(bearbeitenLink, typ, item, editBean)}"
					process="@this"
					update="mainContent"
					rendered="#{authBean.inRole('Sportwart')}"
					disabled="#{item['club.name'] != authBean.loggedInUser.club.name}"/>
		</ui:define>
		<ui:define name="deleteButton">
			<p:commandButton icon="fa fa-trash-o" title="#{bundle.delete}"
					action="#{searchBean.loeschen(typ, item.id)}"
					process="@this"
					update="searchTable messagesPopup"
					onmousedown="updateConfirmDlg('#{messages.deleteTitle}', '#{bundle.format('comfirmMsg', item[firstProperty])}')"
					style="float: right"
					rendered="#{authBean.inRole('Sportwart')}"
					disabled="#{item['club.name'] != authBean.loggedInUser.club.name}">
				<p:confirm icon=""/>
			</p:commandButton>
		</ui:define>
		<ui:define name="addRowButtons">
			<p:commandButton id="racesButton" icon="fa fa-flag-checkered" title="#{bundle.races}"
					action="#{searchBean.bearbeiten('/announcement/racesEdit.xhtml', item.id, racesEditBean)}"
					process="@form"
					update=":mainContent"
					rendered="#{authBean.inRole('Sportwart')}"
					disabled="#{item['club.name'] != authBean.loggedInUser.club.name}"/>
			<p:commandButton icon="fa fa-print" title="#{bundle.createPdf}"
					action="#{announcementBean.uploadBean.create(null, item)}"
					process="@this"
					partialSubmit="true"
					oncomplete="if (args &amp;&amp; !args.validationFailed) { PrimeFaces.addSubmitParam('main',{'token':args.token}); PF('pdfButton').jq.click(); }"/>
			<p:commandButton icon="fa fa-check-circle" title="#{bundle.register}"
					action="#{registrationBean.createRegistration(item)}"
					process="@this"
					update="mainContent"
					rendered="#{authBean.inRole('Sportwart', 'Trainer', 'Mastersportler')}"
					disabled="#{item.status != 'announced'}"/>
			<p:commandButton icon="fa fa-calculator" title="#{bundle.createProgram}"
					action="#{programBean.createProgram(item)}"
					process="@this"
					update="mainContent"
					rendered="#{authBean.inRole('Sportwart')}"
					disabled="#{not (item.status == 'announced' and item['club.name'] == authBean.loggedInUser.club.name)}"/>
		</ui:define>

	</ui:composition>
	
</html>