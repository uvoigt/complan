<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" 
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions">

	<ui:composition template="/templates/edit.xhtml">
		<ui:param name="bundle" value="#{messages.bundle('announcements')}"/>
		<ui:param name="bean" value="#{announcementBean}"/>
		<ui:param name="searchLink" value="/announcement/announcements.xhtml"/>

		<ui:param name="announcement" value="#{announcementBean.announcement}"/>

		<ui:define name="editArea">

			<h:inputHidden id="announcementId" value="#{announcement.id}"/>

			<div class="ui-g">
				<div class="ui-g-12 ui-md-6 ui-lg-3" style="width: 12em"><h:outputText value="#{bundle.name}"/></div>
				<div class="ui-g-12 ui-md-6 ui-lg-8">
					<p:inputText value="#{announcement.name}" autocomplete="off" maxlength="255" required="true"
						requiredMessage="#{bundle.format('fieldValidation', bundle.name)}" style="width: 95%"/>
				</div>
			</div>
			<div class="ui-g">
				<div class="ui-g-12 ui-md-6 ui-lg-3" style="width: 12em"><h:outputText value="#{bundle.category}"/></div>
				<div class="ui-g-12 ui-md-6 ui-lg-8">
					<p:autoComplete value="#{announcement.category}" converter="#{categoryConverter}"
						completeMethod="#{announcementBean.getCategories}" var="category" itemValue="#{category.name}" itemLabel="#{category.name}"
						maxlength="255" required="true" requiredMessage="#{bundle.format('fieldValidation', bundle.category)}"
						style="width: 100%" inputStyle="width: 95%"/>
				</div>
			</div>
			<div class="ui-g">
				<div class="ui-g-12 ui-md-6 ui-lg-3" style="width: 12em"><h:outputText value="#{bundle.dates}"/></div>
				<div class="ui-g-12 ui-md-6 ui-lg-8">
					<div class="ui-g">
						<h:outputText value="#{bundle.startDate}"/>
						<p:calendar widgetVar="startDate"
								value="#{announcement.startDate}" pages="3" required="true"
								requiredMessage="#{bundle.format('fieldValidation', bundle.startDate)}"
								size="7" style="margin: 0 1em 0 1em">
							<p:ajax event="dateSelect" listener="#{announcementBean.startDateChanged}" update="endDate"/>
						</p:calendar>
						<h:outputText value="#{bundle.endDate}"/>
						<p:calendar id="endDate" binding="#{announcementBean.endDate}"
							value="#{announcement.endDate}" pages="3" required="true"
							requiredMessage="#{bundle.format('fieldValidation', bundle.endDate)}"
							size="7" style="margin-left: 1em"/>
					</div>
				</div>
			</div>
			<div class="ui-g">
				<div class="ui-g-12 ui-md-6 ui-lg-3" style="width: 12em"><h:outputText value="#{bundle.location}"/></div>
				<div class="ui-g-12 ui-md-6 ui-lg-8">
					<h:panelGroup>
						<p:selectOneRadio value="#{announcementBean.location}" required="true"
								requiredMessage="#{bundle.format('fieldValidation', bundle.location)}"
								onclick="if (this.value == 'address') {PF('locationEdit').show();} else {PF('locationEdit').hide()}"
								style="float: left">
							<f:selectItem itemValue="club" itemLabel="#{bundle.club}"/>
							<f:selectItem itemValue="address" itemLabel="#{bundle.address}"/>
						</p:selectOneRadio>
						<p:inplace widgetVar="locationEdit">
							<ui:param name="address" value="#{announcement.location.address}"/>
							<ui:include src="/masterdata/addressArea.xhtml"/>
						</p:inplace>
					</h:panelGroup>
				</div>
			</div>
			<div class="ui-g">
				<div class="ui-g-12 ui-md-6 ui-lg-3" style="width: 12em"><h:outputText value="#{bundle.announcement}"/></div>
				<div class="ui-g-12 ui-md-6 ui-lg-8">
					<div class="ui-g">
						<p:commandButton value="#{bundle.setStatus}" action="#{announcementBean.setStatus('announced')}"
							process="announcementId @this" widgetVar="btnAnnounce" onsuccess="PF('btnAnnounce').disable(); PF('btnRevoke').enable()"/>
						<p:commandButton value="#{bundle.revokeStatus}" action="#{announcementBean.setStatus('created')}"
							process="announcementId @this" widgetVar="btnRevoke" onsuccess="PF('btnRevoke').disable(); PF('btnAnnounce').enable()"
							style="margin-left: 10px" rendered="#{authBean.inRole('Tester')}"/>
						<p:commandButton value="#{bundle.testPdf}" action="#{announcementBean.uploadBean.create(null, announcement)}"
							process="@form" style="margin-left: 10px"
							oncomplete="if (args &amp;&amp; !args.validationFailed) { PrimeFaces.addSubmitParam('editForm',{'token':args.token}); PF('pdfButton').jq.click(); }"/>
						<p:commandButton widgetVar="pdfButton" style="display: none"
							action="#{announcementBean.uploadBean.download(null, 'application/pdf', null, null)}"
							ajax="false" process="@this"/>
					</div>
				</div>
			</div>
			<h:outputScript>
				if (#{announcement.id == null or announcement.status != "created"}) {
					PF("btnAnnounce").disable();
					PF("btnRevoke").enable();
				} else {
					PF("btnAnnounce").enable();
					PF("btnRevoke").disable();
				}
				$(editForm).submit(function(e) {
					setTimeout(function() {
						$(editForm).find(".ui-submit-param").remove();
					}, 10);
				});
			</h:outputScript>

			<pe:ckEditor value="#{announcement.text}" widgetVar="annEditor"
				customConfig="javax.faces.resource/editorConfig.js.xhtml?ln=js"
				width="90%"/>

		</ui:define>
	</ui:composition>
</html>