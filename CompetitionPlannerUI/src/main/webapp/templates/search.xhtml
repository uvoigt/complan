<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui">
<head />
<body>
<ui:composition template="/templates/title.xhtml">
<ui:define name="content">

	<h:form id="datenForm" onkeypress="if (event.keyCode == 13) return false;">

		<p:remoteCommand id="updateCommand" name="updateResultCount" process="@this" update="suchErgebnisTable:resultCount"/>

		<p:dataTable id="suchErgebnisTable" widgetVar="suchErgebnisTable"
				var="item" rowKey="#{item.id}"
				value="#{searchBean.getDataModel(typ)}"
				lazy="true" paginator="true" paginatorAlwaysVisible="false"
				emptyMessage="#{bundle.noResult}" filterEvent="enter"
				sortMode="multiple"
				binding="#{searchBean.datatable[null]}"
				rows="10" rowsPerPageTemplate="10,20,50">

			<f:facet name="footer">
				<h:panelGroup id="resultCount">
					<p:outputLabel value="#{bundle.format('count', searchBean.getDataModel(typ).rowCount)}"/>
					<span id="jResultCount" style="visibility: hidden;">#{searchBean.getDataModel(typ).rowCount}</span>
				</h:panelGroup>
			</f:facet>

			<p:ajax event="filter" oncomplete="updateResultCount()"/>
			<p:ajax event="sort" listener="#{searchBean.onSort}"/>
			<f:event type="preRenderView" listener="#{searchBean.preRenderViewListener}"/>

			<p:columns var="column" value="#{searchBean.getColumns(typ)}"
					filterBy="#{item[column.property]}"
					filterValue="#{component.filters[''.concat(column.property)]}"
					sortBy="#{item[column.property]}"
					visible="#{column.visible}">
				<f:facet name="header">
					<h:outputText value="#{column.header}"/>
				</f:facet>
				<ui:param name="wert" value="#{searchBean.render(item, column)}"/>
				<ui:param name="isImage" value="#{wert.startsWith('data:image')}"/>
				<h:graphicImage value="#{wert}" rendered="#{isImage}"/>
				<h:outputText value="#{wert}" rendered="#{!isImage}"/>
			</p:columns>
			<ui:param name="firstProperty" value="#{searchBean.getColumns(typ)[0].property}"/>
			<p:column id="aktionenColumn" toggleable="false" style="width: #{searchBean.calcColWidth(component)}px" styleClass="hiddenHintCol">
				<f:facet name="header">
					<h:outputText value="#{messages.tableHeaderActions}"/>
					<p:commandButton id="toggler" type="button" title="Spalten" style="float:right" icon="ui-icon-calculator" />
					<p:columnToggler datasource="suchErgebnisTable" trigger="toggler">
						<p:ajax event="toggle" listener="#{searchBean.columnChooserListener}"/>
					</p:columnToggler>
				</f:facet>
			
				<p:commandButton icon="ui-icon-pencil" title="#{bundle.modify}"
						action="#{searchBean.bearbeiten(bearbeitenLink, typ, item, editBean)}"
						process="@this"
						update=":mainContent"
						styleClass="editButton"/>
				<ui:insert name="addRowButtons"/>
				<p:commandButton icon="ui-icon-copy" title="#{bundle.copy}"
						action="#{searchBean.kopieren(bearbeitenLink, typ, item, editBean)}"
						process="@this"
						update=":mainContent :messages"/>
				<p:commandButton icon="ui-icon-trash" title="#{bundle.delete}"
						action="#{searchBean.loeschen(typ, item.id)}"
						process="@this"
						update="suchErgebnisTable :messagesPopup"
						onmousedown="updateConfirmDlg('#{messages.deleteTitle}', '#{bundle.format('comfirmMsg', item[firstProperty])}')">
					<p:confirm icon=""/>
				</p:commandButton>
				<h:panelGroup layout="block" id="rowInfo" styleClass="hiddenHint"/>
				<p:tooltip for="rowInfo" value="#{messages.format('lastChangeHover', item.updateTime, startseiteBean.leseBenutzerNamen(item.updateUser))}"/>
			</p:column>
		</p:dataTable>

		<h:panelGroup layout="block" style="margin: 5px; float: left">
			<p:commandButton value="#{bundle.newButton}"
				action="#{searchBean.anlegen(bearbeitenLink, typ, editBean)}"
				process="@this"
				update=":mainContent"
				style="margin-right: 5px"
				rendered="#{renderNewButton}"/>

			<ui:insert name="buttonExt"/>
		</h:panelGroup>
		<h:panelGroup layout="block" style="margin: 5px; float: right" rendered="#{renderDownloadPanel}">
			<p:commandButton value="#{bundle.download}"
					ajax="false"
					action="#{uploadBean.download(typ)}"
					style="float: left; margin-top: 3px">
			</p:commandButton>
			<h:panelGroup layout="block" style="float: left">
				<p:fileUpload fileUploadListener="#{uploadBean.upload}"
						update="importPanel :messagesPopup suchErgebnisTable"
						multiple="true"
						label="#{bundle.chooseUpload}"
						uploadLabel="#{bundle.upload}"
						cancelLabel="#{messages.cancel}"
						style="float: left"/>
				<h:panelGrid id="importPanel" columns="3" style="margin: 5px" rendered="#{renderImportPanel}">
					<p:outputLabel value="#{bundle.format('uploaded', uploadBean.uploadedSize)}"/>
					<p:commandButton value="#{bundle.process}" action="#{uploadBean.processUploaded}"
							process="@this"
							update="importPanel :messagesPopup :leftMenu suchErgebnisTable"
							disabled="#{uploadBean.uploadedSize == 0}"/>
					<p:commandButton value="#{messages.delete}" action="#{uploadBean.deleteUploaded}"
							process="@this"
							update="importPanel"
							disabled="#{uploadBean.uploadedSize == 0}"/>
				</h:panelGrid>
			</h:panelGroup>
		</h:panelGroup>

	</h:form>

</ui:define>
</ui:composition>
</body>
</html>